// Disable 300ms Touch Delay in Mobile
createjs.Touch.enable(stage);

var assestsPath = "sounds/";
var snd_manifest = [{
	id: "bgmLoop",
	src: "bgm.ogg"
}, {
	id: "bellSound",
	src: "bell.ogg"
}];
var queue = new createjs.LoadQueue(true, assestsPath);
createjs.Sound.alternateExtensions = ["m4a"];
queue.installPlugin(createjs.Sound);
queue.on("complete", handleComplete);
queue.on("progress", handleProgress);
queue.loadManifest(snd_manifest);
function handleComplete(event) {
	console.log("Done");
}
function handleProgress(event) {
	console.log("Event Loading: " + (queue.progress.toFixed(2) * 100) + "%");
}

// Detect Page Visibility
function handleVisibilityChange() {
	if (document.hidden) {
		soundLoop.paused = true;
	} else {
		if (soundLoop.paused == true) {
			soundLoop.play();
		}
	}
}

document.addEventListener("visibilitychange", handleVisibilityChange, false);

playSound = function (name) {
	return createjs.Sound.play(name);
}
stopSound = function (name) {
	return createjs.Sound.stop(name);
}

var soundLoop;
playSoundLoop = function () {
	return soundLoop = createjs.Sound.play("bgmLoop", {
		loop: -1
	});
}

this.startBtn.cursor = "pointer";

this.startBtn.addEventListener("click", startBtnClick.bind(this));

function startBtnClick() {
	this.startBtn.visible = false;
	playSoundLoop();
}


// Music btn variable
var musicBtnStatus = "on";

// Movieclip as btn
this.musicBtn.cursor = "pointer";

this.musicBtn.addEventListener("click", musicBtnClick.bind(this));

function musicBtnClick() {
	if (musicBtnStatus == "on") {
		musicBtnStatus = "off";
		this.musicBtn.gotoAndStop("off");
		//createjs.Sound.stop("bgmLoop");
		stopSound("bgmLoop");﻿
	} else {
		musicBtnStatus = "on";
		this.musicBtn.gotoAndStop("on");
		playSoundLoop();﻿
	}
}

this.hotspotBtn1.addEventListener("click", nipple1BtnClick.bind(this));

function nipple1BtnClick() {
	playSound("bellSound");
}

this.hotspotBtn2.addEventListener("click", nipple2BtnClick.bind(this));

function nipple2BtnClick() {
	playSound("bellSound");
}
